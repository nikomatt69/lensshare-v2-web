var u=process.env.LATEST_GIT_COMMIT_SHA,c=class{constructor({cachePrefix:e,staticAssets:t,cacheableRoutes:a,withQueryParams:i}){this.cacheStaticAsset=(e,t)=>{fetch(e).then(a=>{if([200,304].includes(a.status))t.put(e,a).catch(i=>{console.debug(`Failed to cache file - ${e}`,i),console.debug(`Failed to cache file - ${e}`,i)});else throw new Error("Failed to fetch from local")}).catch(console.debug)};this.cacheStaticAssets=async()=>{let e=await caches.open(this.cacheName);for(let t of this.staticAssets)this.cacheStaticAsset(t,e)};this.invalidatePreviousCache=async()=>{let e=await caches.keys();await Promise.all(e.filter(t=>t.startsWith(this.cachePrefix)).map(async t=>t!==this.cacheName?await caches.delete(t):await Promise.resolve(!1)))};this.put=async(e,t)=>{let a=await fetch(e,{cache:"reload"});!a.redirected&&[200,304].includes(a.status)?await t.put(e,a):await t.delete(e)};this.get=async e=>{let{request:t}=e,{pathname:a,search:i}=new URL(t.url),h=`${a}${this.withQueryParams?i:""}`;if((this.staticAssets.has(a)||this.cacheableRoutes.has(a))&&this.cacheName){let l=await caches.open(this.cacheName),d=await l.match(h);if(navigator.onLine&&e.waitUntil(this.put(h,l)),d)return d}return await fetch(t)};this.cachePrefix=e,this.cacheName=`${e}_${u}`,this.staticAssets=new Set(t),this.cacheableRoutes=new Set(a),this.withQueryParams=i??!0}};importScripts("https://progressier.app/UyYlhOtlyHyST7enRwK8/sw.js");var f="https://api.lenshareapp.xyz/leafwatch/impressions",w=5e3,n=null,r=new Set,S=()=>{let s=Array.from(r);s.length>0&&n&&(r.clear(),fetch(f,{body:JSON.stringify({ids:s,viewer_id:n}),headers:{"Content-Type":"application/json"},keepalive:!0,method:"POST"}).then(()=>{}).catch(()=>{}))};setInterval(S,w);var y=process.env.STATIC_ASSETS??[],g=["/","/contact","/explore"],p=["https://static-asset.lenshareapp.xyz","https://asset.lenshareapp.xyz","https://prerender.lenshareapp.xyz"],o=new c({cachePrefix:"SWCache",cacheableRoutes:[...g,...p],staticAssets:y});async function v(){self.skipWaiting(),await o.cacheStaticAssets()}var A=async()=>{await self.clients.claim(),await o.invalidatePreviousCache()},m=s=>{let e=s.request.clone(),{origin:t}=new URL(e.url);(self.location.origin===t||p.includes(t))&&s.respondWith(o.get(s))};self.addEventListener("message",s=>{s.data&&s.data.type==="PUBLICATION_VISIBLE"&&(r.add(s.data.id),n=s.data.viewerId)});self.addEventListener("fetch",m);self.addEventListener("install",s=>s.waitUntil(v()));self.addEventListener("activate",s=>s.waitUntil(A()));
