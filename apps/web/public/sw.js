var a="https://api.mycrumbs.xyz/leafwatch/impressions";var i=null,t=new Set,l=()=>{let e=Array.from(t);e.length>0&&i&&(t.clear(),fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({viewer_id:i,ids:e}),keepalive:!0}).then(()=>{}).catch(()=>{}))};async function o(){self.skipWaiting()}var r=async()=>{await self.clients.claim()},c=e=>{let n=e.request.clone(),{origin:s}=new URL(n.url);self.location.origin===s&&e.respondWith};self.addEventListener("message",e=>{e.data&&e.data.type==="PUBLICATION_VISIBLE"&&(t.add(e.data.id),i=e.data.viewerId)});setInterval(l,5e3);self.addEventListener("fetch",c);self.addEventListener("install",e=>e.waitUntil(o()));self.addEventListener("activate",e=>e.waitUntil(r()));
