var a="https://api.mycrumbs.xyz/leafwatch/impressions",l=5e3,t=null,i=new Set,o=()=>{let e=Array.from(i);e.length>0&&t&&(i.clear(),fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({viewer_id:t,ids:e}),keepalive:!0}).then(()=>{}).catch(()=>{}))};async function r(){self.skipWaiting()}var c=async()=>{await self.clients.claim()},d=e=>{let n=e.request.clone(),{origin:s}=new URL(n.url);self.location.origin===s&&e.respondWith};self.addEventListener("message",e=>{e.data&&e.data.type==="PUBLICATION_VISIBLE"&&(i.add(e.data.id),t=e.data.viewerId)});setInterval(o,l);self.addEventListener("fetch",d);self.addEventListener("install",e=>e.waitUntil(r()));self.addEventListener("activate",e=>e.waitUntil(c()));
